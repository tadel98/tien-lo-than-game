import{_ as H}from"./D1ZCJ6tb.js";import{g as u,r as T,j as P,k as U,c as a,a as t,b as L,w as V,t as n,l as j,F as v,m as b,n as i,o as c,d as I,p as E,q as F,s as X,v as Q}from"#entry";import{u as G}from"./CWJf_NK_.js";import{u as J}from"./C9N9uCYs.js";import{u as K}from"./yAfczJOT.js";const O={class:"min-h-screen bg-gradient-to-br from-gray-900 via-purple-900 to-gray-900"},W={class:"bg-black/50 backdrop-blur-sm border-b border-purple-500/30"},Y={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"},Z={class:"flex items-center justify-between h-16"},tt={class:"flex items-center space-x-4"},et={class:"flex items-center space-x-6"},st={class:"text-center"},ot={class:"text-lg font-semibold text-yellow-400"},nt={class:"text-center"},at={class:"text-lg font-semibold text-blue-400"},it={class:"text-center"},ct={class:"text-lg font-semibold text-green-400"},lt={class:"flex items-center space-x-2"},rt={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8"},dt={class:"mb-8"},ut={class:"grid grid-cols-2 md:grid-cols-4 gap-4"},xt=["onClick"],pt={class:"text-center"},mt={class:"text-3xl mb-2"},ht={class:"text-sm font-semibold text-white"},_t={class:"text-xs text-game-text-secondary"},gt={key:0,class:"text-center py-8"},yt={key:1,class:"text-center py-8"},vt={class:"text-red-400"},bt={key:2,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"},ft={class:"flex items-center justify-between mb-4"},wt={class:"text-xl font-bold text-white"},kt={class:"text-2xl"},Ct={class:"text-game-text-secondary mb-4"},Nt={class:"mb-4"},St={class:"text-sm text-game-text-secondary mb-2"},Tt={class:"text-sm text-game-text-secondary"},Lt=["onClick"],Vt={key:3,class:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4"},jt={class:"bg-gray-900 rounded-lg max-w-4xl w-full max-h-[80vh] overflow-hidden"},It={class:"flex items-center justify-between p-6 border-b border-gray-700"},Rt={class:"flex items-center space-x-3"},zt={class:"text-2xl"},Bt={class:"text-2xl font-bold text-white"},$t={class:"p-6 overflow-y-auto max-h-[60vh]"},Mt={key:0,class:"text-center py-8"},qt={key:1,class:"grid grid-cols-1 md:grid-cols-2 gap-4"},At={class:"flex items-start justify-between mb-3"},Dt={class:"flex items-center space-x-3"},Ht={class:"text-2xl"},Pt={class:"text-lg font-semibold text-white"},Ut={class:"flex items-center space-x-2"},Et={class:"text-xs text-game-text-secondary"},Ft={class:"text-sm text-game-text-secondary mb-3"},Xt={class:"flex items-center justify-between"},Qt={class:"flex items-center space-x-2"},Gt={class:"text-yellow-400 font-semibold"},Jt={class:"text-sm text-game-text-secondary"},Kt={class:"flex items-center space-x-2"},Ot=["onUpdate:modelValue","max"],Wt=["onClick","disabled"],Yt={key:0,class:"text-xs text-game-text-secondary mt-2"},ae={__name:"shop",setup(Zt){const x=G(),r=J(),l=K(),f=u(()=>x.isLoggedIn),h=u(()=>r.player);u(()=>r.resources);const w=u(()=>l.shops),k=u(()=>l.loading),C=u(()=>l.error),p=u(()=>l.currentShop),_=T("all"),m=T({}),N=[{name:"all",displayName:"Tất Cả",icon:"🏪",description:"Xem tất cả cửa hàng"},{name:"equipment",displayName:"Trang Bị",icon:"⚔️",description:"Vũ khí và áo giáp"},{name:"consumables",displayName:"Tiêu Hao",icon:"🧪",description:"Thuốc và vật phẩm"},{name:"materials",displayName:"Nguyên Liệu",icon:"💎",description:"Vật liệu chế tạo"}],R=u(()=>_.value==="all"?w.value:w.value.filter(o=>o.category===_.value)),y=o=>{const s=r.getResourceByName(o);return s?Number(s.amount).toLocaleString():"0"},z=o=>{const s=N.find(d=>d.name===o);return s?s.displayName:o},B=o=>({tien_ngoc:"Tiên Ngọc",linh_thach:"Linh Thạch",nguyen_thach:"Nguyên Thạch"})[o]||o,S=o=>l.getRarityColor(o),$=o=>l.getItemTypeIcon(o),M=o=>{l.setCurrentShop(o),o.items.forEach(s=>{m.value[s.id]=1})},q=o=>{const s=m.value[o.id]||1,d=o.price*s,e=r.getResourceByName(o.currency);return e?Number(e.amount)>=d&&(o.stock===-1||o.stock>=s)&&h.value.level>=o.level:!1},A=async o=>{if(!h.value?.id)return;const s=m.value[o.id]||1;try{await l.purchaseItem(h.value.id,p.value.id,o.id,s),await r.fetchResources(h.value.id),console.log(`Mua thành công ${o.displayName} x${s}`)}catch(d){console.error("Lỗi mua hàng:",d)}},D=()=>{x.logout(),r.reset(),l.reset()};return P(async()=>{x.initializeAuth(),f.value&&x.user?.player&&(await r.initializePlayer(x.user.player.id),await l.fetchShops())}),U(f,async o=>{o&&x.user?.player?(await r.initializePlayer(x.user.player.id),await l.fetchShops()):l.reset()}),(o,s)=>{const d=H;return c(),a("div",O,[t("header",W,[t("div",Y,[t("div",Z,[t("div",tt,[L(d,{to:"/",class:"text-2xl font-bold text-white"},{default:V(()=>[...s[1]||(s[1]=[I(" 🏪 Cửa Hàng ",-1)])]),_:1})]),t("div",et,[t("div",st,[s[2]||(s[2]=t("p",{class:"text-sm text-game-text-secondary"},"Tiên Ngọc",-1)),t("p",ot,n(y("tien_ngoc")),1)]),t("div",nt,[s[3]||(s[3]=t("p",{class:"text-sm text-game-text-secondary"},"Linh Thạch",-1)),t("p",at,n(y("linh_thach")),1)]),t("div",it,[s[4]||(s[4]=t("p",{class:"text-sm text-game-text-secondary"},"Nguyên Thạch",-1)),t("p",ct,n(y("nguyen_thach")),1)])]),t("div",lt,[L(d,{to:"/",class:"game-button px-6 py-2 rounded-lg text-white font-semibold"},{default:V(()=>[...s[5]||(s[5]=[I(" 🏠 Trang Chủ ",-1)])]),_:1}),t("button",{onClick:D,class:"game-button px-6 py-2 rounded-lg text-white font-semibold"}," 🚪 Đăng Xuất ")])])])]),t("main",rt,[t("div",dt,[s[6]||(s[6]=t("h2",{class:"text-2xl font-bold text-white mb-4"},"Danh Mục Cửa Hàng",-1)),t("div",ut,[(c(),a(v,null,b(N,e=>t("button",{key:e.name,onClick:g=>_.value=e.name,class:E(["p-4 rounded-lg border-2 transition-all duration-300",i(_)===e.name?"border-purple-500 bg-purple-500/20":"border-gray-600 bg-gray-800/50 hover:border-purple-400"])},[t("div",pt,[t("div",mt,n(e.icon),1),t("div",ht,n(e.displayName),1),t("div",_t,n(e.description),1)])],10,xt)),64))])]),i(k)?(c(),a("div",gt,[...s[7]||(s[7]=[t("div",{class:"text-white"},"Đang tải cửa hàng...",-1)])])):i(C)?(c(),a("div",yt,[t("div",vt,"Lỗi: "+n(i(C)),1)])):(c(),a("div",bt,[(c(!0),a(v,null,b(i(R),e=>(c(),a("div",{key:e.id,class:"game-card p-6 rounded-lg"},[t("div",ft,[t("h3",wt,n(e.displayName),1),t("span",kt,n(e.icon),1)]),t("p",Ct,n(e.description),1),t("div",Nt,[t("div",St,"Số lượng item: "+n(e.items.length),1),t("div",Tt,"Loại: "+n(z(e.category)),1)]),t("button",{onClick:g=>M(e),class:"w-full game-button py-2 px-4 rounded-lg text-white font-semibold"}," Vào Cửa Hàng ",8,Lt)]))),128))])),i(p)?(c(),a("div",Vt,[t("div",jt,[t("div",It,[t("div",Rt,[t("span",zt,n(i(p).icon),1),t("h2",Bt,n(i(p).displayName),1)]),t("button",{onClick:s[0]||(s[0]=e=>p.value=null),class:"text-gray-400 hover:text-white text-2xl"}," ✕ ")]),t("div",$t,[i(p).items.length===0?(c(),a("div",Mt,[...s[8]||(s[8]=[t("div",{class:"text-game-text-secondary"},"Cửa hàng này chưa có item nào",-1)])])):(c(),a("div",qt,[(c(!0),a(v,null,b(i(p).items,e=>(c(),a("div",{key:e.id,class:"bg-gray-800/50 p-4 rounded-lg border border-gray-700"},[t("div",At,[t("div",Dt,[t("span",Ht,n($(e.itemType)),1),t("div",null,[t("h4",Pt,n(e.displayName),1),t("div",Ut,[t("span",{class:"px-2 py-1 rounded text-xs font-semibold",style:F({backgroundColor:S(e.rarity)+"20",color:S(e.rarity)})},n(e.rarity.toUpperCase()),5),t("span",Et,"Cấp "+n(e.level),1)])])])]),t("p",Ft,n(e.description),1),t("div",Xt,[t("div",Qt,[t("span",Gt,n(e.price.toLocaleString()),1),t("span",Jt,n(B(e.currency)),1)]),t("div",Kt,[X(t("input",{"onUpdate:modelValue":g=>i(m)[e.id]=g,type:"number",min:"1",max:e.stock===-1?999:e.stock,class:"w-16 px-2 py-1 bg-gray-700 text-white rounded text-sm"},null,8,Ot),[[Q,i(m)[e.id],void 0,{number:!0}]]),t("button",{onClick:g=>A(e),disabled:i(k)||!q(e),class:"px-4 py-2 bg-green-600 hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed rounded text-sm font-semibold text-white"}," Mua ",8,Wt)])]),e.stock!==-1?(c(),a("div",Yt," Còn lại: "+n(e.stock),1)):j("",!0)]))),128))]))])])])):j("",!0)])])}}};export{ae as default};
