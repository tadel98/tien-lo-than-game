import{_ as Q}from"./Bm7vLDfF.js";import{_ as W}from"./D1ZCJ6tb.js";import{u as Z}from"./CWJf_NK_.js";import{u as I}from"./C9N9uCYs.js";import{z as ee,r as k,g as p,j as te,k as se,c,n as d,b as E,a as e,t as a,w as B,F as P,m as A,l as T,o as u,d as R,p as j,q,y as oe}from"#entry";const ne=ee("talent",()=>{const w=k([]),m=k([]),f=k([]),l=k({}),g=k(!1),h=k(null),y=p(()=>w.value.filter(n=>n.isUnlocked)),N=p(()=>w.value.filter(n=>n.isUnlocked&&n.isActive)),L=p(()=>f.value.filter(n=>n.expiresAt?new Date(n.expiresAt)>new Date:!0)),U=p(()=>{const n=new Map;return m.value.forEach(r=>{r?.talent?.type?.id&&(n.has(r.talent.type.id)||n.set(r.talent.type.id,r.talent.type))}),Array.from(n.values())}),C=async n=>{try{g.value=!0,h.value=null;const r=await $fetch(`/api/talent/status?playerId=${n}`);w.value=r.data.playerTalents,m.value=r.data.availableTalents,f.value=r.data.playerBuffs,l.value=r.data.totalEffects}catch(r){h.value=r.message,console.error("Error fetching talent status:",r)}finally{g.value=!1}};return{playerTalents:w,availableTalents:m,playerBuffs:f,totalEffects:l,loading:g,error:h,unlockedTalents:y,activeTalents:N,activeBuffs:L,talentTypes:U,fetchTalentStatus:C,unlockTalent:async(n,r)=>{try{g.value=!0,h.value=null;const i=await $fetch("/api/talent/unlock",{method:"POST",body:{playerId:n,talentId:r}});return await C(n),i.data}catch(i){throw h.value=i.message,console.error("Error unlocking talent:",i),i}finally{g.value=!1}},upgradeTalent:async(n,r)=>{try{g.value=!0,h.value=null;const i=await $fetch("/api/talent/upgrade",{method:"POST",body:{playerId:n,talentId:r}});return await C(n),i.data}catch(i){throw h.value=i.message,console.error("Error upgrading talent:",i),i}finally{g.value=!1}},toggleTalent:async(n,r,i)=>{try{g.value=!0,h.value=null;const x=await $fetch("/api/talent/toggle",{method:"POST",body:{playerId:n,talentId:r,isActive:i}});return await C(n),x.data}catch(x){throw h.value=x.message,console.error("Error toggling talent:",x),x}finally{g.value=!1}},getRarityColor:n=>({common:"#6b7280",uncommon:"#10b981",rare:"#3b82f6",epic:"#8b5cf6",legendary:"#f59e0b",mythic:"#ef4444"})[n]||"#6b7280",getTalentTypeColor:n=>({combat:"#ef4444",cultivation:"#8b5cf6",defense:"#10b981",utility:"#06b6d4",special:"#f59e0b"})[n]||"#6b7280",getBuffTypeColor:n=>({buff:"#10b981",debuff:"#ef4444",neutral:"#6b7280"})[n]||"#6b7280",canUnlockTalent:(n,r,i)=>{if(!n.requirements)return!0;const x=n.requirements;return!(x.level&&r<x.level||x.realm&&i!==x.realm)},canUpgradeTalent:n=>n.isUnlocked&&n.level<n.talent.maxLevel,getTalentUpgradeCost:n=>n.talent.cost*n.level,reset:()=>{w.value=[],m.value=[],f.value=[],l.value={},g.value=!1,h.value=null}}}),ae={key:0,class:"min-h-screen"},re={key:1,class:"min-h-screen text-white"},le={class:"bg-game-gray/80 backdrop-blur-sm border-b border-white/10"},ie={class:"container mx-auto px-4 py-3"},ce={class:"flex items-center justify-between"},de={class:"flex items-center space-x-4"},ue={class:"w-12 h-12 rounded-full bg-gradient-to-br from-blue-400 to-purple-600 flex items-center justify-center"},ge={class:"text-lg font-bold"},me={class:"text-lg font-semibold"},he={class:"text-sm text-game-text-secondary"},pe={class:"flex items-center space-x-6"},fe={class:"text-center"},xe={class:"text-lg font-semibold text-yellow-400"},ve={class:"text-center"},ye={class:"text-lg font-semibold text-blue-400"},be={class:"text-center"},_e={class:"text-lg font-semibold text-green-400"},Te={class:"flex items-center space-x-2"},ke={class:"bg-game-gray/60 backdrop-blur-sm border-b border-white/10"},we={class:"container mx-auto px-4 py-2"},Ce={class:"flex space-x-1 mb-4"},Ne={class:"grid grid-cols-7 gap-4"},Le=["onClick"],Ue={class:"w-12 h-12 rounded-full bg-game-light flex items-center justify-center mb-2"},Se={class:"text-2xl"},$e={class:"text-xs text-center"},Me={class:"container mx-auto px-4 py-8"},Ee={class:"max-w-4xl mx-auto mb-8"},Pe={class:"game-card p-6 rounded-lg"},Ae={class:"grid grid-cols-2 md:grid-cols-4 gap-4"},Re={class:"text-sm text-game-text-secondary mb-1"},je={class:"max-w-6xl mx-auto mb-8"},qe={class:"flex space-x-2 mb-6"},Be=["onClick"],Ve={class:"mr-2"},De={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"},ze={class:"flex items-center justify-between mb-4"},Oe={class:"flex items-center space-x-3"},Ke={class:"w-12 h-12 rounded-full bg-game-light flex items-center justify-center"},Fe={class:"text-2xl"},He={class:"text-lg font-semibold text-white"},Xe={class:"flex items-center space-x-2"},Ye={key:0,class:"flex items-center space-x-2"},Ge=["onClick"],Je={class:"text-sm text-game-text-secondary mb-4"},Qe={key:0,class:"mb-4"},We={class:"flex justify-between items-center mb-2"},Ze={class:"text-sm font-semibold"},Ie={class:"w-full bg-game-light rounded-full h-2 mb-2"},et={class:"text-xs text-game-text-secondary"},tt={key:1,class:"mb-4"},st={class:"text-xs"},ot={key:0},nt={key:1},at={class:"flex space-x-2"},rt=["onClick","disabled"],lt=["onClick","disabled"],it={key:2,disabled:"",class:"flex-1 bg-gray-500 py-2 px-4 rounded-lg text-white font-semibold cursor-not-allowed"},ct={key:0,class:"mt-4 p-3 bg-red-500/20 border border-red-500/50 rounded-lg"},dt={class:"text-red-400 text-sm"},ft={__name:"talent",setup(w){const m=Z(),f=I(),l=ne(),g=k(null),h=p(()=>m.isLoggedIn),y=p(()=>f.player);p(()=>f.resources);const N=p(()=>l.loading),L=p(()=>l.error),U=p(()=>l.playerTalents);p(()=>l.availableTalents);const C=p(()=>l.totalEffects),S=p(()=>l.talentTypes),V=p(()=>g.value?U.value.filter(s=>s.talent.type.id===g.value):U.value),$=s=>{const o=f.getResourceByName(s);return o?Number(o.amount).toLocaleString():"0"},D=()=>{m.logout(),f.reset(),l.reset()},z=s=>{s.route?oe(s.route):console.log(`${s.name} chưa được phát triển`)},M=s=>({attack:"Tấn Công",defense:"Phòng Thủ",speed:"Tốc Độ",hp:"Máu",mp:"Pháp Lực",luck:"May Mắn",wisdom:"Trí Tuệ",strength:"Sức Mạnh",agility:"Nhanh Nhẹn",vitality:"Sinh Lực",spirit:"Tinh Thần",expMultiplier:"Kinh Nghiệm",dropRate:"Tỷ Lệ Rơi",critChance:"Tỷ Lệ Chí Mạng",critDamage:"Sát Thương Chí Mạng"})[s]||s,O=s=>({attack:"#ef4444",defense:"#10b981",speed:"#8b5cf6",hp:"#ef4444",mp:"#3b82f6",luck:"#f59e0b",wisdom:"#06b6d4",strength:"#84cc16",agility:"#ec4899",vitality:"#14b8a6",spirit:"#6366f1",expMultiplier:"#8b5cf6",dropRate:"#f59e0b",critChance:"#ef4444",critDamage:"#dc2626"})[s]||"#6b7280",K=(s,o)=>s.includes("Multiplier")||s.includes("Rate")?`+${((o-1)*100).toFixed(1)}%`:`+${o}`,F=(s,o)=>{if(!s)return"Không có";const v=[];for(const[_,t]of Object.entries(s))if(typeof t=="number")v.push(`${M(_)}: +${t*o}`);else if(typeof t=="object"&&t.scaling){const b=t.base+t.scaling*o;v.push(`${M(_)}: +${b}`)}return v.join(", ")},H=async(s,o)=>{try{await l.unlockTalent(s,o),await f.fetchResources(s)}catch(v){console.error("Lỗi mở khóa thiên phú:",v)}},n=async(s,o)=>{try{await l.upgradeTalent(s,o),await f.fetchResources(s)}catch(v){console.error("Lỗi nâng cấp thiên phú:",v)}},r=async(s,o,v)=>{try{await l.toggleTalent(s,o,v)}catch(_){console.error("Lỗi kích hoạt/tắt thiên phú:",_)}},i=s=>l.getRarityColor(s),x=s=>l.getTalentTypeColor(s),X=(s,o,v)=>l.canUnlockTalent(s,o,v),Y=s=>l.canUpgradeTalent(s),G=s=>l.getTalentUpgradeCost(s),J=[{name:"Nhân vật",icon:"👤",active:!1,route:"/character"},{name:"Thiên Phú",icon:"⭐",active:!0},{name:"Cửa Hàng",icon:"🏠",active:!1,route:"/shop"},{name:"Túi",icon:"🎒",active:!1,route:"/inventory"},{name:"Tu Luyện",icon:"🧘",active:!1,route:"/cultivation"},{name:"Đạo Lô",icon:"🔥",active:!1,route:"/furnace"},{name:"Linh Thú",icon:"🐾",active:!1,route:"/spirit-beast"},{name:"Đạo Lữ",icon:"👥",active:!1},{name:"Pháp Bảo",icon:"⚔️",active:!1},{name:"Luyện Đan",icon:"⚗️",active:!1},{name:"Luyện Khí",icon:"🔨",active:!1},{name:"Trận pháp",icon:"🔮",active:!1},{name:"Xếp Hạng",icon:"🏆",active:!1,route:"/ranking"},{name:"Danh hiệu",icon:"👑",active:!1},{name:"Nhiệm Vụ",icon:"📋",active:!1,route:"/quest"},{name:"Nạp Thẻ",icon:"🏛️",active:!1}];return te(async()=>{m.initializeAuth(),h.value&&m.user?.player&&(await f.initializePlayer(m.user.player.id),await l.fetchTalentStatus(m.user.player.id),S.value.length>0&&(g.value=S.value[0].id))}),se(h,async s=>{s&&m.user?.player?(await f.initializePlayer(m.user.player.id),await l.fetchTalentStatus(m.user.player.id)):l.reset()}),(s,o)=>{const v=Q,_=W;return d(h)?(u(),c("div",re,[e("header",le,[e("div",ie,[e("div",ce,[e("div",de,[e("div",ue,[e("span",ge,a(d(y)?.name?.charAt(0)||"V"),1)]),e("div",null,[e("h2",me,a(d(y)?.name||"Viễn Cổ Đại Năng"),1),e("p",he,"Cấp "+a(d(y)?.level||138)+" | Chuyển: "+a(d(y)?.realm||"Phàm cảnh"),1)])]),e("div",pe,[e("div",fe,[o[0]||(o[0]=e("p",{class:"text-sm text-game-text-secondary"},"Tiên Ngọc",-1)),e("p",xe,a($("tien_ngoc")),1)]),e("div",ve,[o[1]||(o[1]=e("p",{class:"text-sm text-game-text-secondary"},"Linh Thạch",-1)),e("p",ye,a($("linh_thach")),1)]),e("div",be,[o[2]||(o[2]=e("p",{class:"text-sm text-game-text-secondary"},"Nguyên Thạch",-1)),e("p",_e,a($("nguyen_thach")),1)])]),e("div",Te,[E(_,{to:"/",class:"game-button px-6 py-2 rounded-lg text-white font-semibold"},{default:B(()=>[...o[3]||(o[3]=[R(" 🏠 Trang Chủ ",-1)])]),_:1}),e("button",{onClick:D,class:"px-4 py-2 bg-red-500/20 border border-red-500/50 rounded-lg text-red-400 hover:bg-red-500/30 transition-colors"}," Đăng xuất ")])])])]),e("nav",ke,[e("div",we,[e("div",Ce,[E(_,{to:"/character",class:"px-4 py-2 text-game-text-secondary hover:text-white transition-colors"},{default:B(()=>[...o[4]||(o[4]=[R(" Nhân vật ",-1)])]),_:1}),E(_,{to:"/cultivation",class:"px-4 py-2 text-game-text-secondary hover:text-white transition-colors"},{default:B(()=>[...o[5]||(o[5]=[R(" Tu Luyện ",-1)])]),_:1}),o[6]||(o[6]=e("button",{class:"px-4 py-2 bg-game-light rounded-lg text-white font-medium"}," Thiên Phú ",-1))]),e("div",Ne,[(u(),c(P,null,A(J,t=>e("div",{key:t.name,onClick:b=>z(t),class:j(["flex flex-col items-center p-3 rounded-lg hover:bg-game-light/50 transition-colors cursor-pointer",{"bg-game-accent/20 border border-game-accent":t.active}])},[e("div",Ue,[e("span",Se,a(t.icon),1)]),e("span",$e,a(t.name),1)],10,Le)),64))])])]),e("main",Me,[o[10]||(o[10]=e("div",{class:"text-center mb-8"},[e("h1",{class:"text-4xl font-bold mb-4"},"⭐ Thiên Phú"),e("p",{class:"text-game-text-secondary"},"Kích hoạt và nâng cấp tài năng đặc biệt của bạn")],-1)),e("div",Ee,[e("div",Pe,[o[7]||(o[7]=e("h3",{class:"text-xl font-semibold text-white mb-4 text-center"},"Tổng Hiệu Ứng Thiên Phú",-1)),e("div",Ae,[s.value!==0&&s.value!==1?(u(!0),c(P,{key:0},A(d(C),(t,b)=>(u(),c("div",{key:b,class:"bg-game-light/30 p-3 rounded-lg text-center"},[e("div",Re,a(M(b)),1),e("div",{class:"text-lg font-semibold",style:q({color:O(b)})},a(K(b,t)),5)]))),128)):T("",!0)])])]),e("div",je,[e("div",qe,[(u(!0),c(P,null,A(d(S),t=>(u(),c("button",{key:t.id,onClick:b=>g.value=t.id,class:j(["px-4 py-2 rounded-lg transition-colors",d(g)===t.id?"bg-game-accent text-white":"bg-game-light/30 text-game-text-secondary hover:bg-game-light/50"])},[e("span",Ve,a(t.icon),1),R(" "+a(t.displayName),1)],10,Be))),128))]),e("div",De,[(u(!0),c(P,null,A(d(V),t=>(u(),c("div",{key:t.id,class:j(["game-card p-6 rounded-lg",{"opacity-50":!t.isUnlocked}])},[e("div",ze,[e("div",Oe,[e("div",Ke,[e("span",Fe,a(t.icon),1)]),e("div",null,[e("h4",He,a(t.displayName),1),e("div",Xe,[e("span",{class:"text-xs px-2 py-1 rounded",style:q({backgroundColor:i(t.rarity)+"20",color:i(t.rarity)})},a(t.rarity?.toUpperCase()||"COMMON"),5),e("span",{class:"text-xs px-2 py-1 rounded",style:q({backgroundColor:x(t.type.name)+"20",color:x(t.type.name)})},a(t.type.displayName),5)])])]),t.isUnlocked?(u(),c("div",Ye,[e("button",{onClick:b=>r(d(y).id,t.id,!t.isActive),class:j(["w-8 h-8 rounded-full flex items-center justify-center transition-colors",t.isActive?"bg-green-500 text-white":"bg-gray-500 text-white"])},a(t.isActive?"✓":"○"),11,Ge)])):T("",!0)]),e("p",Je,a(t.description),1),t.isUnlocked?(u(),c("div",Qe,[e("div",We,[o[8]||(o[8]=e("span",{class:"text-sm text-game-text-secondary"},"Cấp độ:",-1)),e("span",Ze,a(t.level)+"/"+a(t.maxLevel),1)]),e("div",Ie,[e("div",{class:"h-2 rounded-full transition-all duration-300",style:q({width:`${t.level/t.maxLevel*100}%`,backgroundColor:i(t.rarity)})},null,4)]),e("div",et," Hiệu ứng: "+a(F(t.effects,t.level)),1)])):T("",!0),t.requirements&&!t.isUnlocked?(u(),c("div",tt,[o[9]||(o[9]=e("div",{class:"text-xs text-game-text-secondary mb-2"},"Yêu cầu:",-1)),e("div",st,[t.requirements.level?(u(),c("div",ot,"Cấp "+a(t.requirements.level),1)):T("",!0),t.requirements.realm?(u(),c("div",nt,a(t.requirements.realm),1)):T("",!0)])])):T("",!0),e("div",at,[t.isUnlocked?Y(t)?(u(),c("button",{key:1,onClick:b=>n(d(y).id,t.id),disabled:d(N),class:"flex-1 bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 py-2 px-4 rounded-lg text-white font-semibold disabled:opacity-50 disabled:cursor-not-allowed"}," Nâng Cấp ("+a(G(t))+" Tiên Ngọc) ",9,lt)):(u(),c("button",it," Đã Đạt Cấp Tối Đa ")):(u(),c("button",{key:0,onClick:b=>H(d(y).id,t.id),disabled:!X(t,d(y).level,d(y).realm)||d(N),class:"flex-1 game-button py-2 px-4 rounded-lg text-white font-semibold disabled:opacity-50 disabled:cursor-not-allowed"}," Mở Khóa ("+a(t.cost)+" Tiên Ngọc) ",9,rt))])],2))),128))])]),d(L)?(u(),c("div",ct,[e("p",dt,a(d(L)),1)])):T("",!0)])])):(u(),c("div",ae,[E(v)]))}}};export{ft as default};
