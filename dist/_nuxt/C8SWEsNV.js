import{_ as W}from"./D1ZCJ6tb.js";import{z as Y,r as m,g,j as Z,k as tt,c as d,a as t,b as X,w as q,t as o,l as C,F as L,m as $,n as i,s as et,v as st,E as nt,o as c,d as Q,p as ot,q as j}from"#entry";import{u as lt}from"./CWJf_NK_.js";import{u as at}from"./C9N9uCYs.js";const it=Y("spiritBeast",()=>{const b=m([]),x=m([]),p=m([]),r=m([]),k=m([]),u=m(!1),h=m(null),G=s=>b.value.filter(a=>a.typeId===s),A=()=>b.value.filter(s=>s.isActive),S=()=>b.value.filter(s=>s.isFighting),w=s=>x.value.find(a=>a.id===s),T=s=>p.value.find(a=>a.id===s),y=s=>r.value.find(a=>a.id===s),v=s=>({common:"#6b7280",rare:"#3b82f6",epic:"#8b5cf6",legendary:"#f59e0b",mythical:"#ef4444"})[s]||"#6b7280",f=s=>({easy:"#10b981",normal:"#f59e0b",hard:"#f97316",extreme:"#ef4444"})[s]||"#6b7280",z=s=>s.health<30?"#ef4444":s.happiness<30?"#f97316":s.hunger<30?"#f59e0b":"#10b981",D=s=>s.health<30?"Bị thương":s.happiness<30?"Buồn bã":s.hunger<30?"Đói":"Khỏe mạnh",N=async s=>{try{u.value=!0,h.value=null;const a=await $fetch(`/api/spirit-beast/status?playerId=${s}`);b.value=a.data.spiritBeasts,x.value=a.data.beastTypes,p.value=a.data.foods,r.value=a.data.huntingGrounds,k.value=a.data.recentHunting}catch(a){h.value=a.message,console.error("Error fetching spirit beast status:",a)}finally{u.value=!1}};return{spiritBeasts:b,beastTypes:x,foods:p,huntingGrounds:r,recentHunting:k,loading:u,error:h,getBeastsByType:G,getActiveBeasts:A,getFightingBeasts:S,getBeastTypeById:w,getFoodById:T,getHuntingGroundById:y,getCategoryColor:v,getDifficultyColor:f,getBeastStatusColor:z,getBeastStatusText:D,fetchSpiritBeastStatus:N,huntBeast:async(s,a)=>{try{u.value=!0,h.value=null;const _=await $fetch("/api/spirit-beast/hunt",{method:"POST",body:{playerId:s,groundId:a}});return await N(s),_}catch(_){throw h.value=_.message,console.error("Error hunting beast:",_),_}finally{u.value=!1}},feedBeast:async(s,a,_,R=1)=>{try{u.value=!0,h.value=null;const l=await $fetch("/api/spirit-beast/feed",{method:"POST",body:{playerId:s,beastId:a,foodId:_,quantity:R}});return await N(s),l}catch(l){throw h.value=l.message,console.error("Error feeding beast:",l),l}finally{u.value=!1}},canHuntAtGround:(s,a)=>a>=s.level,getBeastStats:s=>{try{return JSON.parse(s.stats)}catch{return{}}},getBeastSkills:s=>{try{return s.skills?JSON.parse(s.skills):[]}catch{return[]}},getFoodEffects:s=>{try{return JSON.parse(s.effects)}catch{return{}}},getGroundBeastTypes:s=>{try{return JSON.parse(s.beastTypes)}catch{return{}}},getGroundDropRates:s=>{try{return JSON.parse(s.dropRates)}catch{return{}}},reset:()=>{b.value=[],x.value=[],p.value=[],r.value=[],k.value=[],u.value=!1,h.value=null}}}),rt={class:"min-h-screen bg-gradient-to-br from-gray-900 via-purple-900 to-gray-900"},dt={class:"bg-black/50 backdrop-blur-sm border-b border-purple-500/30"},ct={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"},ut={class:"flex items-center justify-between h-16"},ht={class:"flex items-center space-x-4"},xt={class:"flex items-center space-x-6"},gt={class:"text-center"},pt={class:"text-lg font-semibold text-yellow-400"},mt={class:"text-center"},yt={class:"text-lg font-semibold text-blue-400"},vt={class:"text-center"},_t={class:"text-lg font-semibold text-green-400"},ft={class:"flex items-center space-x-2"},bt={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8"},wt={class:"mb-8"},kt={class:"flex space-x-1 bg-gray-800/50 p-1 rounded-lg"},Bt=["onClick"],Ct={class:"flex items-center justify-center space-x-2"},St={class:"text-lg"},Tt={key:0,class:"space-y-8"},Nt={class:"game-card p-6 rounded-lg"},Lt={class:"grid grid-cols-2 md:grid-cols-4 gap-4"},$t={class:"text-center"},jt={class:"text-2xl font-bold text-blue-400"},Gt={class:"text-center"},At={class:"text-2xl font-bold text-green-400"},Ft={class:"text-center"},Ht={class:"text-2xl font-bold text-purple-400"},zt={class:"text-center"},Dt={class:"text-2xl font-bold text-yellow-400"},Et={key:0,class:"text-center py-12"},Mt={key:1,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"},Ot={class:"flex items-center justify-between mb-4"},Rt={class:"flex items-center space-x-3"},Vt={class:"text-3xl"},Jt={class:"text-lg font-semibold text-white"},Pt={class:"flex items-center space-x-2"},It={class:"text-xs text-game-text-secondary"},Kt={class:"mb-4 space-y-2"},Ut={class:"flex justify-between"},Xt={class:"flex items-center space-x-2"},qt={class:"w-16 bg-gray-700 rounded-full h-2"},Qt={class:"text-sm text-white"},Wt={class:"flex justify-between"},Yt={class:"flex items-center space-x-2"},Zt={class:"w-16 bg-gray-700 rounded-full h-2"},te={class:"text-sm text-white"},ee={class:"flex justify-between"},se={class:"flex items-center space-x-2"},ne={class:"w-16 bg-gray-700 rounded-full h-2"},oe={class:"text-sm text-white"},le={class:"mb-4"},ae={class:"grid grid-cols-2 gap-2 text-xs"},ie={class:"text-game-text-secondary"},re={class:"text-white"},de={class:"flex space-x-2"},ce=["onClick","disabled"],ue=["onClick","disabled"],he={key:1,class:"space-y-8"},xe={class:"game-card p-6 rounded-lg"},ge={key:0,class:"text-center py-8"},pe={key:1,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"},me={class:"flex items-center justify-between mb-4"},ye={class:"text-lg font-semibold text-white"},ve={class:"text-2xl"},_e={class:"text-sm text-game-text-secondary mb-4"},fe={class:"mb-4 space-y-2"},be={class:"flex justify-between"},we={class:"text-sm text-white"},ke={class:"flex justify-between"},Be=["onClick","disabled"],Ce={key:2,class:"space-y-8"},Se={class:"game-card p-6 rounded-lg"},Te={key:0,class:"text-center py-8"},Ne={key:1,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"},Le={class:"flex items-center justify-between mb-4"},$e={class:"text-lg font-semibold text-white"},je={class:"text-2xl"},Ge={class:"text-sm text-game-text-secondary mb-4"},Ae={class:"mb-4"},Fe={class:"flex justify-between mb-2"},He={class:"text-sm text-white"},ze={class:"flex justify-between"},De={class:"text-sm text-white"},Ee=["onClick"],Me={key:3,class:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4"},Oe={class:"bg-gray-900 rounded-lg max-w-md w-full"},Re={class:"p-6"},Ve={key:0,class:"mb-4"},Je={class:"flex items-center space-x-3 mb-4"},Pe={class:"text-2xl"},Ie={class:"text-white font-semibold"},Ke={class:"text-sm text-game-text-secondary"},Ue={key:1,class:"mb-4"},Xe={class:"flex items-center space-x-3 mb-4"},qe={class:"text-2xl"},Qe={class:"text-white font-semibold"},We={class:"text-sm text-game-text-secondary"},Ye={class:"mb-4"},Ze={class:"flex space-x-2"},ts=["disabled"],ls={__name:"spirit-beast",setup(b){const x=lt(),p=at(),r=it(),k=g(()=>x.isLoggedIn),u=g(()=>p.player);g(()=>p.resources);const h=g(()=>r.spiritBeasts);g(()=>r.beastTypes);const G=g(()=>r.foods),A=g(()=>r.huntingGrounds);g(()=>r.recentHunting);const S=g(()=>r.loading);g(()=>r.error);const w=m("beasts"),T=m(!1),y=m(null),v=m(null),f=m(1),z=[{name:"beasts",displayName:"Linh Thú",icon:"🐾"},{name:"hunting",displayName:"Săn Bắt",icon:"🏹"},{name:"feeding",displayName:"Cho Ăn",icon:"🍖"}],D=g(()=>r.getActiveBeasts()),N=g(()=>r.getFightingBeasts()),V=g(()=>{if(h.value.length===0)return 0;const l=h.value.reduce((e,H)=>e+H.level,0);return Math.round(l/h.value.length)}),F=l=>{const e=p.getResourceByName(l);return e?Number(e.amount).toLocaleString():"0"},E=l=>r.getCategoryColor(l),J=l=>r.getDifficultyColor(l),M=(l,e)=>r.canHuntAtGround(l,e),P=l=>r.getBeastStats(l),I=l=>({tien_ngoc:"Tiên Ngọc",linh_thach:"Linh Thạch",nguyen_thach:"Nguyên Thạch"})[l]||l,K=async l=>{if(u.value?.id)try{const e=await r.huntBeast(u.value.id,l.id);e.success?(console.log(`Săn thành công tại ${l.displayName}!`),e.beast&&console.log(`Bắt được: ${e.beast.name}`)):console.log(`Săn thất bại tại ${l.displayName}`)}catch(e){console.error("Lỗi săn linh thú:",e)}},O=(l,e)=>{y.value=l,v.value=e,T.value=!0,f.value=1},s=()=>{T.value=!1,y.value=null,v.value=null,f.value=1},a=async()=>{if(!(!u.value?.id||!y.value||!v.value))try{await r.feedBeast(u.value.id,y.value.id,v.value.id,f.value),await p.fetchResources(u.value.id),console.log(`Cho ăn thành công: ${y.value.name}`),s()}catch(l){console.error("Lỗi cho ăn:",l)}},_=async l=>{console.log(`Chơi với ${l.name}`)},R=()=>{x.logout(),p.reset(),r.reset()};return Z(async()=>{x.initializeAuth(),k.value&&x.user?.player&&(await p.initializePlayer(x.user.player.id),await r.fetchSpiritBeastStatus(x.user.player.id))}),tt(k,async l=>{l&&x.user?.player?(await p.initializePlayer(x.user.player.id),await r.fetchSpiritBeastStatus(x.user.player.id)):r.reset()}),(l,e)=>{const H=W;return c(),d("div",rt,[t("header",dt,[t("div",ct,[t("div",ut,[t("div",ht,[X(H,{to:"/",class:"text-2xl font-bold text-white"},{default:q(()=>[...e[1]||(e[1]=[Q(" 🐾 Linh Thú ",-1)])]),_:1})]),t("div",xt,[t("div",gt,[e[2]||(e[2]=t("p",{class:"text-sm text-game-text-secondary"},"Tiên Ngọc",-1)),t("p",pt,o(F("tien_ngoc")),1)]),t("div",mt,[e[3]||(e[3]=t("p",{class:"text-sm text-game-text-secondary"},"Linh Thạch",-1)),t("p",yt,o(F("linh_thach")),1)]),t("div",vt,[e[4]||(e[4]=t("p",{class:"text-sm text-game-text-secondary"},"Nguyên Thạch",-1)),t("p",_t,o(F("nguyen_thach")),1)])]),t("div",ft,[X(H,{to:"/",class:"game-button px-6 py-2 rounded-lg text-white font-semibold"},{default:q(()=>[...e[5]||(e[5]=[Q(" 🏠 Trang Chủ ",-1)])]),_:1}),t("button",{onClick:R,class:"game-button px-6 py-2 rounded-lg text-white font-semibold"}," 🚪 Đăng Xuất ")])])])]),t("main",bt,[t("div",wt,[t("div",kt,[(c(),d(L,null,$(z,n=>t("button",{key:n.name,onClick:B=>w.value=n.name,class:ot(["flex-1 px-4 py-2 rounded-md text-sm font-medium transition-all duration-300",i(w)===n.name?"bg-purple-600 text-white":"text-gray-300 hover:text-white hover:bg-gray-700"])},[t("div",Ct,[t("span",St,o(n.icon),1),t("span",null,o(n.displayName),1)])],10,Bt)),64))])]),i(w)==="beasts"?(c(),d("div",Tt,[t("div",Nt,[e[10]||(e[10]=t("h2",{class:"text-2xl font-bold text-white mb-4"},"Thống Kê Linh Thú",-1)),t("div",Lt,[t("div",$t,[t("div",jt,o(i(h).length),1),e[6]||(e[6]=t("div",{class:"text-sm text-game-text-secondary"},"Tổng Linh Thú",-1))]),t("div",Gt,[t("div",At,o(i(D).length),1),e[7]||(e[7]=t("div",{class:"text-sm text-game-text-secondary"},"Đang Hoạt Động",-1))]),t("div",Ft,[t("div",Ht,o(i(N).length),1),e[8]||(e[8]=t("div",{class:"text-sm text-game-text-secondary"},"Đang Chiến Đấu",-1))]),t("div",zt,[t("div",Dt,o(i(V)),1),e[9]||(e[9]=t("div",{class:"text-sm text-game-text-secondary"},"Cấp Trung Bình",-1))])])]),i(h).length===0?(c(),d("div",Et,[...e[11]||(e[11]=[t("div",{class:"text-6xl mb-4"},"🐾",-1),t("div",{class:"text-xl text-white mb-2"},"Chưa có linh thú nào",-1),t("div",{class:"text-game-text-secondary"},"Hãy đi săn để thu thập linh thú!",-1)])])):(c(),d("div",Mt,[(c(!0),d(L,null,$(i(h),n=>(c(),d("div",{key:n.id,class:"bg-gray-800/50 p-6 rounded-lg border border-gray-700 hover:border-purple-500/50 transition-all duration-300"},[t("div",Ot,[t("div",Rt,[t("span",Vt,o(n.type.icon),1),t("div",null,[t("h3",Jt,o(n.name),1),t("div",Pt,[t("span",{class:"px-2 py-1 rounded text-xs font-semibold",style:j({backgroundColor:E(n.type.category)+"20",color:E(n.type.category)})},o(n.type.category.toUpperCase()),5),t("span",It,"Cấp "+o(n.level),1)])])])]),t("div",Kt,[t("div",Ut,[e[12]||(e[12]=t("span",{class:"text-sm text-game-text-secondary"},"Sức khỏe:",-1)),t("div",Xt,[t("div",qt,[t("div",{class:"bg-red-500 h-2 rounded-full transition-all duration-300",style:j({width:`${n.health}%`})},null,4)]),t("span",Qt,o(n.health)+"%",1)])]),t("div",Wt,[e[13]||(e[13]=t("span",{class:"text-sm text-game-text-secondary"},"Hạnh phúc:",-1)),t("div",Yt,[t("div",Zt,[t("div",{class:"bg-yellow-500 h-2 rounded-full transition-all duration-300",style:j({width:`${n.happiness}%`})},null,4)]),t("span",te,o(n.happiness)+"%",1)])]),t("div",ee,[e[14]||(e[14]=t("span",{class:"text-sm text-game-text-secondary"},"Độ no:",-1)),t("div",se,[t("div",ne,[t("div",{class:"bg-green-500 h-2 rounded-full transition-all duration-300",style:j({width:`${n.hunger}%`})},null,4)]),t("span",oe,o(n.hunger)+"%",1)])])]),t("div",le,[e[15]||(e[15]=t("h4",{class:"text-sm font-semibold text-white mb-2"},"Thống kê:",-1)),t("div",ae,[(c(!0),d(L,null,$(P(n),(B,U)=>(c(),d("div",{key:U,class:"flex justify-between"},[t("span",ie,o(U)+":",1),t("span",re,o(B),1)]))),128))])]),t("div",de,[t("button",{onClick:B=>O(n),disabled:n.hunger>=100,class:"flex-1 px-3 py-2 bg-green-600 hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed rounded text-sm font-semibold text-white"}," Cho Ăn ",8,ce),t("button",{onClick:B=>_(n),disabled:n.happiness>=100,class:"flex-1 px-3 py-2 bg-blue-600 hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed rounded text-sm font-semibold text-white"}," Chơi ",8,ue)])]))),128))]))])):C("",!0),i(w)==="hunting"?(c(),d("div",he,[t("div",xe,[e[19]||(e[19]=t("h2",{class:"text-2xl font-bold text-white mb-4"},"Khu Vực Săn",-1)),i(A).length===0?(c(),d("div",ge,[...e[16]||(e[16]=[t("div",{class:"text-game-text-secondary"},"Chưa có khu vực săn nào",-1)])])):(c(),d("div",pe,[(c(!0),d(L,null,$(i(A),n=>(c(),d("div",{key:n.id,class:"bg-gray-800/50 p-6 rounded-lg border border-gray-700 hover:border-purple-500/50 transition-all duration-300"},[t("div",me,[t("h3",ye,o(n.displayName),1),t("span",ve,o(n.icon),1)]),t("p",_e,o(n.description),1),t("div",fe,[t("div",be,[e[17]||(e[17]=t("span",{class:"text-sm text-game-text-secondary"},"Cấp độ yêu cầu:",-1)),t("span",we,o(n.level),1)]),t("div",ke,[e[18]||(e[18]=t("span",{class:"text-sm text-game-text-secondary"},"Độ khó:",-1)),t("span",{class:"text-sm font-semibold",style:j({color:J(n.difficulty)})},o(n.difficulty.toUpperCase()),5)])]),t("button",{onClick:B=>K(n),disabled:!M(n,i(u)?.level||0)||i(S),class:"w-full px-4 py-2 bg-purple-600 hover:bg-purple-700 disabled:opacity-50 disabled:cursor-not-allowed rounded text-sm font-semibold text-white"},o(M(n,i(u)?.level||0)?"Đi Săn":`Cần cấp ${n.level}`),9,Be)]))),128))]))])])):C("",!0),i(w)==="feeding"?(c(),d("div",Ce,[t("div",Se,[e[23]||(e[23]=t("h2",{class:"text-2xl font-bold text-white mb-4"},"Thức Ăn Linh Thú",-1)),i(G).length===0?(c(),d("div",Te,[...e[20]||(e[20]=[t("div",{class:"text-game-text-secondary"},"Chưa có thức ăn nào",-1)])])):(c(),d("div",Ne,[(c(!0),d(L,null,$(i(G),n=>(c(),d("div",{key:n.id,class:"bg-gray-800/50 p-6 rounded-lg border border-gray-700 hover:border-purple-500/50 transition-all duration-300"},[t("div",Le,[t("h3",$e,o(n.displayName),1),t("span",je,o(n.icon),1)]),t("p",Ge,o(n.description),1),t("div",Ae,[t("div",Fe,[e[21]||(e[21]=t("span",{class:"text-sm text-game-text-secondary"},"Giá:",-1)),t("span",He,o(n.price.toLocaleString())+" "+o(I(n.currency)),1)]),t("div",ze,[e[22]||(e[22]=t("span",{class:"text-sm text-game-text-secondary"},"Loại:",-1)),t("span",De,o(n.category),1)])]),t("button",{onClick:B=>O(null,n),class:"w-full px-4 py-2 bg-green-600 hover:bg-green-700 rounded text-sm font-semibold text-white"}," Mua & Cho Ăn ",8,Ee)]))),128))]))])])):C("",!0),i(T)?(c(),d("div",Me,[t("div",Oe,[t("div",{class:"flex items-center justify-between p-6 border-b border-gray-700"},[e[24]||(e[24]=t("h2",{class:"text-xl font-bold text-white"},"Cho Ăn Linh Thú",-1)),t("button",{onClick:s,class:"text-gray-400 hover:text-white text-2xl"}," ✕ ")]),t("div",Re,[i(y)?(c(),d("div",Ve,[t("div",Je,[t("span",Pe,o(i(y).type.icon),1),t("div",null,[t("div",Ie,o(i(y).name),1),t("div",Ke,o(i(y).type.displayName),1)])])])):C("",!0),i(v)?(c(),d("div",Ue,[t("div",Xe,[t("span",qe,o(i(v).icon),1),t("div",null,[t("div",Qe,o(i(v).displayName),1),t("div",We,o(i(v).description),1)])]),t("div",Ye,[e[25]||(e[25]=t("label",{class:"block text-sm text-game-text-secondary mb-2"},"Số lượng:",-1)),et(t("input",{"onUpdate:modelValue":e[0]||(e[0]=n=>nt(f)?f.value=n:null),type:"number",min:"1",max:"10",class:"w-full px-3 py-2 bg-gray-700 text-white rounded"},null,512),[[st,i(f),void 0,{number:!0}]])])])):C("",!0),t("div",Ze,[t("button",{onClick:a,disabled:i(S),class:"flex-1 px-4 py-2 bg-green-600 hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed rounded text-sm font-semibold text-white"},o(i(S)?"Đang xử lý...":"Xác nhận"),9,ts),t("button",{onClick:s,class:"flex-1 px-4 py-2 bg-gray-600 hover:bg-gray-700 rounded text-sm font-semibold text-white"}," Hủy ")])])])])):C("",!0)])])}}};export{ls as default};
