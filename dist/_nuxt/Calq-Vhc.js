import{_ as F}from"./D1ZCJ6tb.js";import{u as J}from"./CWJf_NK_.js";import{u as D}from"./C9N9uCYs.js";import{u as H}from"./yAfczJOT.js";import{z as X,r as w,g as y,j as G,k as Q,c as l,a as t,b as K,w as M,t as o,l as U,n as f,F as v,m as b,o as c,d as P,p as V,q as W}from"#entry";const Y=X("furnace",()=>{const C=w([]),d=w([]),m=w([]),x=w(!1),i=w(null),R=n=>d.value.filter(a=>a.category===n),_=n=>d.value.find(a=>a.id===n),T=n=>C.value.find(a=>a.furnace.id===n),p=n=>({alchemy:"🧪",forging:"🔨",crafting:"⚒️"})[n]||"🔧",L=n=>({alchemy:"Luyện Đan",forging:"Luyện Khí",crafting:"Chế Tạo"})[n]||n,j=n=>n>=.8?"#10b981":n>=.6?"#f59e0b":n>=.4?"#f97316":"#ef4444",N=async n=>{try{x.value=!0,i.value=null;const a=await $fetch(`/api/furnace/status?playerId=${n}`);C.value=a.data.furnaces,d.value=a.data.recipes,m.value=a.data.recentCrafting}catch(a){i.value=a.message,console.error("Error fetching furnace status:",a)}finally{x.value=!1}};return{furnaces:C,recipes:d,recentCrafting:m,loading:x,error:i,getRecipesByCategory:R,getRecipeById:_,getFurnaceById:T,getCategoryIcon:p,getCategoryName:L,getSuccessRateColor:j,fetchFurnaceStatus:N,craftItem:async(n,a,g=1)=>{try{x.value=!0,i.value=null;const u=await $fetch("/api/furnace/craft",{method:"POST",body:{playerId:n,recipeId:a,quantity:g}});return await N(n),u.data}catch(u){throw i.value=u.message,console.error("Error crafting item:",u),u}finally{x.value=!1}},canCraft:(n,a)=>{if(!n)return!1;try{const g=JSON.parse(n.materials);for(const[u,B]of Object.entries(g)){const k=a.find(O=>O.name===u);if(!k||k.quantity<B)return!1}return!0}catch{return!1}},getRequiredMaterials:n=>{if(!n)return[];try{const a=JSON.parse(n.materials);return Object.entries(a).map(([g,u])=>({name:g,amount:Number(u)}))}catch{return[]}},getCraftResult:n=>{if(!n)return[];try{const a=JSON.parse(n.result);return Object.entries(a).map(([g,u])=>({name:g,amount:Number(u)}))}catch{return[]}},reset:()=>{C.value=[],d.value=[],m.value=[],x.value=!1,i.value=null}}}),Z={class:"min-h-screen bg-gradient-to-br from-gray-900 via-purple-900 to-gray-900"},tt={class:"bg-black/50 backdrop-blur-sm border-b border-purple-500/30"},et={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"},st={class:"flex items-center justify-between h-16"},nt={class:"flex items-center space-x-4"},ot={class:"flex items-center space-x-6"},at={class:"text-center"},rt={class:"text-lg font-semibold text-yellow-400"},it={class:"text-center"},lt={class:"text-lg font-semibold text-blue-400"},ct={class:"text-center"},dt={class:"text-lg font-semibold text-green-400"},ut={class:"flex items-center space-x-2"},xt={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8"},mt={class:"mb-8"},gt={class:"game-card p-6 rounded-lg"},ft={key:0,class:"text-center py-8"},ht={key:1,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"},yt={class:"flex items-center justify-between mb-3"},_t={class:"text-lg font-semibold text-white"},pt={class:"text-2xl"},vt={class:"space-y-2"},bt={class:"flex justify-between"},wt={class:"text-sm text-white"},Ct={class:"flex justify-between"},Nt={class:"text-sm text-white"},St={class:"flex justify-between"},kt={class:"text-sm text-green-400"},Rt={class:"mb-8"},Tt={class:"grid grid-cols-2 md:grid-cols-3 gap-4"},Lt=["onClick"],jt={class:"text-center"},It={class:"text-3xl mb-2"},qt={class:"text-sm font-semibold text-white"},Bt={class:"text-xs text-game-text-secondary"},Ot={key:0,class:"text-center py-8"},$t={key:1,class:"text-center py-8"},zt={class:"text-red-400"},At={key:2,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"},Kt={class:"flex items-center justify-between mb-4"},Mt={class:"flex items-center space-x-3"},Pt={class:"text-2xl"},Vt={class:"text-lg font-semibold text-white"},Et={class:"text-xs text-game-text-secondary"},Ft={class:"text-sm text-game-text-secondary mb-4"},Jt={class:"mb-4"},Dt={class:"space-y-1"},Ht={class:"text-game-text-secondary"},Xt={class:"text-white"},Gt={class:"mb-4"},Qt={class:"space-y-1"},Ut={class:"text-game-text-secondary"},Wt={class:"text-green-400"},Yt={class:"mb-4 space-y-2"},Zt={class:"flex justify-between"},te={class:"text-xs text-white"},ee={class:"flex justify-between"},se={class:"flex justify-between"},ne={class:"text-xs text-blue-400"},oe=["onClick","disabled"],ae={key:3,class:"mt-12"},re={class:"game-card p-6 rounded-lg"},ie={class:"space-y-3"},le={class:"flex items-center space-x-3"},ce={class:"text-lg"},de={class:"text-white font-semibold"},ue={class:"text-xs text-game-text-secondary"},xe={class:"text-right"},me={class:"text-xs text-game-text-secondary"},pe={__name:"furnace",setup(C){const d=J(),m=D(),x=H(),i=Y(),R=y(()=>d.isLoggedIn),_=y(()=>m.player);y(()=>m.resources);const T=y(()=>i.furnaces),p=y(()=>i.recipes),L=y(()=>i.recentCrafting),j=y(()=>i.loading),N=y(()=>i.error),S=w("all"),$=[{name:"all",displayName:"Tất Cả",icon:"🔧"},{name:"alchemy",displayName:"Luyện Đan",icon:"🧪"},{name:"forging",displayName:"Luyện Khí",icon:"🔨"},{name:"crafting",displayName:"Chế Tạo",icon:"⚒️"}],z=y(()=>S.value==="all"?p.value:p.value.filter(r=>r.category===S.value)),I=r=>{const e=m.getResourceByName(r);return e?Number(e.amount).toLocaleString():"0"},q=r=>i.getCategoryIcon(r),n=r=>i.getCategoryName(r),a=r=>i.getSuccessRateColor(r),g=r=>i.getRequiredMaterials(r),u=r=>i.getCraftResult(r),B=r=>r==="all"?p.value.length:p.value.filter(e=>e.category===r).length,k=r=>!_.value||_.value.level<r.level?!1:i.canCraft(r,x.inventory),O=async r=>{if(_.value?.id)try{const e=await i.craftItem(_.value.id,r.id,1);await x.fetchInventory(_.value.id),e.success?console.log(`Chế tạo thành công: ${r.displayName}`):console.log(`Chế tạo thất bại: ${r.displayName}`)}catch(e){console.error("Lỗi chế tạo:",e)}},E=()=>{d.logout(),m.reset(),x.reset(),i.reset()};return G(async()=>{d.initializeAuth(),R.value&&d.user?.player&&(await m.initializePlayer(d.user.player.id),await x.fetchInventory(d.user.player.id),await i.fetchFurnaceStatus(d.user.player.id))}),Q(R,async r=>{r&&d.user?.player?(await m.initializePlayer(d.user.player.id),await x.fetchInventory(d.user.player.id),await i.fetchFurnaceStatus(d.user.player.id)):i.reset()}),(r,e)=>{const A=F;return c(),l("div",Z,[t("header",tt,[t("div",et,[t("div",st,[t("div",nt,[K(A,{to:"/",class:"text-2xl font-bold text-white"},{default:M(()=>[...e[0]||(e[0]=[P(" 🔥 Đạo Lô ",-1)])]),_:1})]),t("div",ot,[t("div",at,[e[1]||(e[1]=t("p",{class:"text-sm text-game-text-secondary"},"Tiên Ngọc",-1)),t("p",rt,o(I("tien_ngoc")),1)]),t("div",it,[e[2]||(e[2]=t("p",{class:"text-sm text-game-text-secondary"},"Linh Thạch",-1)),t("p",lt,o(I("linh_thach")),1)]),t("div",ct,[e[3]||(e[3]=t("p",{class:"text-sm text-game-text-secondary"},"Nguyên Thạch",-1)),t("p",dt,o(I("nguyen_thach")),1)])]),t("div",ut,[K(A,{to:"/",class:"game-button px-6 py-2 rounded-lg text-white font-semibold"},{default:M(()=>[...e[4]||(e[4]=[P(" 🏠 Trang Chủ ",-1)])]),_:1}),t("button",{onClick:E,class:"game-button px-6 py-2 rounded-lg text-white font-semibold"}," 🚪 Đăng Xuất ")])])])]),t("main",xt,[t("div",mt,[t("div",gt,[e[9]||(e[9]=t("h2",{class:"text-2xl font-bold text-white mb-4"},"Trạng Thái Lò Đạo",-1)),f(T).length===0?(c(),l("div",ft,[...e[5]||(e[5]=[t("div",{class:"text-6xl mb-4"},"🔥",-1),t("div",{class:"text-xl text-white mb-2"},"Chưa có lò đạo",-1),t("div",{class:"text-game-text-secondary"},"Hãy mua lò đạo tại cửa hàng!",-1)])])):(c(),l("div",ht,[(c(!0),l(v,null,b(f(T),s=>(c(),l("div",{key:s.id,class:"bg-gray-800/50 p-4 rounded-lg border border-gray-700"},[t("div",yt,[t("h3",_t,o(s.furnace.displayName),1),t("span",pt,o(s.furnace.icon),1)]),t("div",vt,[t("div",bt,[e[6]||(e[6]=t("span",{class:"text-sm text-game-text-secondary"},"Cấp độ:",-1)),t("span",wt,o(s.level)+"/"+o(s.furnace.maxLevel),1)]),t("div",Ct,[e[7]||(e[7]=t("span",{class:"text-sm text-game-text-secondary"},"Kinh nghiệm:",-1)),t("span",Nt,o(s.experience),1)]),t("div",St,[e[8]||(e[8]=t("span",{class:"text-sm text-game-text-secondary"},"Hiệu suất:",-1)),t("span",kt,o((s.furnace.efficiency*100).toFixed(1))+"%",1)])])]))),128))]))])]),t("div",Rt,[e[10]||(e[10]=t("h2",{class:"text-2xl font-bold text-white mb-4"},"Công Thức Chế Tạo",-1)),t("div",Tt,[(c(),l(v,null,b($,s=>t("button",{key:s.name,onClick:h=>S.value=s.name,class:V(["p-4 rounded-lg border-2 transition-all duration-300",f(S)===s.name?"border-purple-500 bg-purple-500/20":"border-gray-600 bg-gray-800/50 hover:border-purple-400"])},[t("div",jt,[t("div",It,o(s.icon),1),t("div",qt,o(s.displayName),1),t("div",Bt,o(B(s.name))+" công thức",1)])],10,Lt)),64))])]),f(j)?(c(),l("div",Ot,[...e[11]||(e[11]=[t("div",{class:"text-white"},"Đang tải công thức...",-1)])])):f(N)?(c(),l("div",$t,[t("div",zt,"Lỗi: "+o(f(N)),1)])):(c(),l("div",At,[(c(!0),l(v,null,b(f(z),s=>(c(),l("div",{key:s.id,class:"bg-gray-800/50 p-6 rounded-lg border border-gray-700 hover:border-purple-500/50 transition-all duration-300"},[t("div",Kt,[t("div",Mt,[t("span",Pt,o(q(s.category)),1),t("div",null,[t("h3",Vt,o(s.displayName),1),t("div",Et,o(n(s.category)),1)])])]),t("p",Ft,o(s.description),1),t("div",Jt,[e[12]||(e[12]=t("h4",{class:"text-sm font-semibold text-white mb-2"},"Nguyên liệu cần:",-1)),t("div",Dt,[(c(!0),l(v,null,b(g(s),h=>(c(),l("div",{key:h.name,class:"flex justify-between text-xs"},[t("span",Ht,o(h.name),1),t("span",Xt,o(h.amount),1)]))),128))])]),t("div",Gt,[e[13]||(e[13]=t("h4",{class:"text-sm font-semibold text-white mb-2"},"Kết quả:",-1)),t("div",Qt,[(c(!0),l(v,null,b(u(s),h=>(c(),l("div",{key:h.name,class:"flex justify-between text-xs"},[t("span",Ut,o(h.name),1),t("span",Wt,o(h.amount),1)]))),128))])]),t("div",Yt,[t("div",Zt,[e[14]||(e[14]=t("span",{class:"text-xs text-game-text-secondary"},"Cấp độ yêu cầu:",-1)),t("span",te,o(s.level),1)]),t("div",ee,[e[15]||(e[15]=t("span",{class:"text-xs text-game-text-secondary"},"Tỷ lệ thành công:",-1)),t("span",{class:"text-xs font-semibold",style:W({color:a(s.successRate)})},o((s.successRate*100).toFixed(1))+"% ",5)]),t("div",se,[e[16]||(e[16]=t("span",{class:"text-xs text-game-text-secondary"},"Kinh nghiệm:",-1)),t("span",ne,o(s.experience),1)])]),t("button",{onClick:h=>O(s),disabled:!k(s)||f(j),class:"w-full px-4 py-2 bg-purple-600 hover:bg-purple-700 disabled:opacity-50 disabled:cursor-not-allowed rounded text-sm font-semibold text-white transition-all duration-300"},o(k(s)?"Chế Tạo":"Thiếu nguyên liệu"),9,oe)]))),128))])),f(L).length>0?(c(),l("div",ae,[e[17]||(e[17]=t("h2",{class:"text-2xl font-bold text-white mb-4"},"Lịch Sử Chế Tạo",-1)),t("div",re,[t("div",ie,[(c(!0),l(v,null,b(f(L),s=>(c(),l("div",{key:s.id,class:"flex items-center justify-between p-3 bg-gray-800/30 rounded-lg"},[t("div",le,[t("span",ce,o(q(s.recipe.category)),1),t("div",null,[t("div",de,o(s.recipe.displayName),1),t("div",ue,o(new Date(s.createdAt).toLocaleString()),1)])]),t("div",xe,[t("div",{class:V(["text-sm font-semibold",s.success?"text-green-400":"text-red-400"])},o(s.success?"Thành công":"Thất bại"),3),t("div",me,"x"+o(s.quantity),1)])]))),128))])])])):U("",!0)])])}}};export{pe as default};
