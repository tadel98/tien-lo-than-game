{"file":"cultivation-DK9EEHEv.js","mappings":"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","names":["_ssrRenderAttrs","_mergeProps","currentRealm","_unref","_ssrInterpolate","_push","_parent","_ssrRenderList","_ssrRenderClass","_ssrRenderStyle","_ssrIncludeBooleanAttr"],"sources":["../../../../components/LevelUpNotification.vue","../../../../node_modules/nuxt/dist/app/compat/interval.js","../../../../stores/cultivation.ts","../../../../pages/cultivation.vue"],"sourcesContent":["<template>\r\n  <Transition\r\n    enter-active-class=\"transition-all duration-500 ease-out\"\r\n    enter-from-class=\"opacity-0 scale-50 translate-y-8\"\r\n    enter-to-class=\"opacity-100 scale-100 translate-y-0\"\r\n    leave-active-class=\"transition-all duration-300 ease-in\"\r\n    leave-from-class=\"opacity-100 scale-100 translate-y-0\"\r\n    leave-to-class=\"opacity-0 scale-50 translate-y-8\"\r\n  >\r\n    <div \r\n      v-if=\"show\"\r\n      class=\"fixed top-4 right-4 z-50 bg-gradient-to-r from-yellow-500 to-orange-500 text-white p-6 rounded-xl shadow-2xl border-2 border-yellow-400/50 max-w-sm\"\r\n    >\r\n      <div class=\"flex items-center space-x-3\">\r\n        <div class=\"text-4xl animate-bounce\">🎉</div>\r\n        <div>\r\n          <div class=\"text-xl font-bold\">Level Up!</div>\r\n          <div class=\"text-sm opacity-90\">\r\n            +{{ levelGain }} level{{ levelGain > 1 ? 's' : '' }}\r\n          </div>\r\n          <div class=\"text-xs opacity-75 mt-1\">\r\n            Level {{ newLevel }}\r\n          </div>\r\n        </div>\r\n      </div>\r\n      \r\n      <div class=\"mt-3 text-xs opacity-90\">\r\n        Chúc mừng! Bạn đã trở nên mạnh mẽ hơn!\r\n      </div>\r\n    </div>\r\n  </Transition>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, watch } from 'vue'\r\n\r\n// Props\r\nconst props = defineProps({\r\n  show: {\r\n    type: Boolean,\r\n    default: false\r\n  },\r\n  levelGain: {\r\n    type: Number,\r\n    default: 0\r\n  },\r\n  newLevel: {\r\n    type: Number,\r\n    default: 0\r\n  }\r\n})\r\n\r\n// Auto hide after 3 seconds\r\nwatch(() => props.show, (newVal) => {\r\n  if (newVal) {\r\n    setTimeout(() => {\r\n      // Emit event to parent to hide notification\r\n      emit('hide')\r\n    }, 3000)\r\n  }\r\n})\r\n\r\n// Emits\r\nconst emit = defineEmits(['hide'])\r\n</script>\r\n","import { createError } from \"../composables/error.js\";\nconst intervalError = \"[nuxt] `setInterval` should not be used on the server. Consider wrapping it with an `onNuxtReady`, `onBeforeMount` or `onMounted` lifecycle hook, or ensure you only call it in the browser by checking `import.meta.client`.\";\nexport const setInterval = import.meta.client ? window.setInterval : () => {\n  if (import.meta.dev) {\n    throw createError({\n      statusCode: 500,\n      message: intervalError\n    });\n  }\n  console.error(intervalError);\n};\n","import { defineStore } from 'pinia'\r\nimport { ref, computed } from 'vue'\r\n\r\nexport const useCultivationStore = defineStore('cultivation', () => {\r\n  // State\r\n  const cultivationStatus = ref<any>(null)\r\n  const isCultivating = ref(false)\r\n  const loading = ref(false)\r\n  const error = ref(null)\r\n  const autoCultivation = ref(false)\r\n  const autoCultivationInterval = ref<any>(null)\r\n\r\n  // Getters\r\n  const canCultivate = computed(() => {\r\n    return cultivationStatus.value?.canCultivate || false\r\n  })\r\n\r\n  const canBreakthrough = computed(() => {\r\n    if (!cultivationStatus.value) return false\r\n    const { currentExp, nextLevelExp } = cultivationStatus.value.cultivation\r\n    return currentExp >= nextLevelExp\r\n  })\r\n\r\n  const progressPercentage = computed(() => {\r\n    return cultivationStatus.value?.cultivation?.progressPercentage || 0\r\n  })\r\n\r\n  const currentRealm = computed(() => {\r\n    return cultivationStatus.value?.cultivation?.realm || 'Phàm cảnh'\r\n  })\r\n\r\n  // Actions\r\n  const fetchCultivationStatus = async (playerId: string) => {\r\n    try {\r\n      loading.value = true\r\n      error.value = null\r\n\r\n      const response: any = await $fetch(`/api/cultivation/status?playerId=${playerId}`)\r\n      cultivationStatus.value = response.data\r\n    } catch (err: any) {\r\n      error.value = err.message\r\n      console.error('Error fetching cultivation status:', err)\r\n    } finally {\r\n      loading.value = false\r\n    }\r\n  }\r\n\r\n  const startCultivation = async (playerId: string, cultivationType: string = 'basic') => {\r\n    try {\r\n      loading.value = true\r\n      error.value = null\r\n      isCultivating.value = true\r\n\r\n      const response: any = await $fetch('/api/cultivation/start', {\r\n        method: 'POST',\r\n        body: {\r\n          playerId,\r\n          cultivationType\r\n        }\r\n      })\r\n\r\n      // Cập nhật trạng thái tu luyện\r\n      await fetchCultivationStatus(playerId)\r\n\r\n      return response.data\r\n    } catch (err: any) {\r\n      error.value = err.message\r\n      console.error('Error starting cultivation:', err)\r\n      throw err\r\n    } finally {\r\n      loading.value = false\r\n      isCultivating.value = false\r\n    }\r\n  }\r\n\r\n  const breakthrough = async (playerId: string) => {\r\n    try {\r\n      loading.value = true\r\n      error.value = null\r\n\r\n      const response: any = await $fetch('/api/cultivation/breakthrough', {\r\n        method: 'POST',\r\n        body: {\r\n          playerId\r\n        }\r\n      })\r\n\r\n      // Cập nhật trạng thái tu luyện\r\n      await fetchCultivationStatus(playerId)\r\n\r\n      return response.data\r\n    } catch (err: any) {\r\n      error.value = err.message\r\n      console.error('Error breakthrough:', err)\r\n      throw err\r\n    } finally {\r\n      loading.value = false\r\n    }\r\n  }\r\n\r\n  const getCultivationInfo = (level: number) => {\r\n    const realms = [\r\n      { name: 'Phàm cảnh', min: 1, max: 9, color: '#6b7280' },\r\n      { name: 'Luyện Khí cảnh', min: 10, max: 49, color: '#3b82f6' },\r\n      { name: 'Trúc Cơ cảnh', min: 50, max: 99, color: '#10b981' },\r\n      { name: 'Kim Đan cảnh', min: 100, max: 199, color: '#f59e0b' },\r\n      { name: 'Nguyên Anh cảnh', min: 200, max: 499, color: '#ef4444' },\r\n      { name: 'Hóa Thần cảnh', min: 500, max: 999, color: '#8b5cf6' },\r\n      { name: 'Hợp Thể cảnh', min: 1000, max: 1000, color: '#f97316' } // Cảnh giới cao nhất\r\n    ]\r\n\r\n    const currentRealm = realms.find(realm => level >= realm.min && level <= realm.max) || realms[0]\r\n    const nextRealm = realms.find(realm => realm.min > level) || realms[realms.length - 1]\r\n\r\n    return {\r\n      currentRealm,\r\n      nextRealm,\r\n      isMaxLevel: level >= 1000 // Cảnh giới cao nhất là level 1000\r\n    }\r\n  }\r\n\r\n  const getRealmColor = (realm: string) => {\r\n    const realmColors = {\r\n      'Phàm cảnh': '#6b7280',\r\n      'Luyện Khí cảnh': '#3b82f6',\r\n      'Trúc Cơ cảnh': '#10b981',\r\n      'Kim Đan cảnh': '#f59e0b',\r\n      'Nguyên Anh cảnh': '#ef4444',\r\n      'Hóa Thần cảnh': '#8b5cf6',\r\n      'Hợp Thể cảnh': '#f97316'\r\n    }\r\n    return realmColors[realm] || '#6b7280'\r\n  }\r\n\r\n  // Auto cultivation methods\r\n  const startAutoCultivation = (playerId: string, cultivationType: string = 'basic') => {\r\n    if (autoCultivationInterval.value) {\r\n      clearInterval(autoCultivationInterval.value)\r\n    }\r\n    \r\n    autoCultivation.value = true\r\n    \r\n    autoCultivationInterval.value = setInterval(async () => {\r\n      if (!autoCultivation.value) {\r\n        stopAutoCultivation()\r\n        return\r\n      }\r\n      \r\n      try {\r\n        // Gọi API tu luyện tự động\r\n        const response: any = await $fetch('/api/cultivation/auto-cultivate', {\r\n          method: 'POST',\r\n          body: {\r\n            playerId,\r\n            expGain: 1000\r\n          }\r\n        })\r\n        \r\n        // Cập nhật trạng thái tu luyện\r\n        await fetchCultivationStatus(playerId)\r\n        \r\n        // Hiển thị thông báo level up nếu có\r\n        if (response.data.cultivation.levelUp) {\r\n          console.log(`🎉 Level Up! +${response.data.cultivation.levelGain} level(s)`)\r\n          // Emit event để component có thể bắt được\r\n          if (typeof window !== 'undefined') {\r\n            window.dispatchEvent(new CustomEvent('levelUp', {\r\n              detail: {\r\n                levelGain: response.data.cultivation.levelGain,\r\n                newLevel: response.data.cultivation.newLevel\r\n              }\r\n            }))\r\n          }\r\n        }\r\n        \r\n      } catch (err) {\r\n        console.error('Auto cultivation error:', err)\r\n        stopAutoCultivation()\r\n      }\r\n    }, 6000) // Tu luyện mỗi 6 giây\r\n  }\r\n\r\n  const stopAutoCultivation = () => {\r\n    autoCultivation.value = false\r\n    if (autoCultivationInterval.value) {\r\n      clearInterval(autoCultivationInterval.value)\r\n      autoCultivationInterval.value = null\r\n    }\r\n  }\r\n\r\n  const toggleAutoCultivation = (playerId: string, cultivationType: string = 'basic') => {\r\n    if (autoCultivation.value) {\r\n      stopAutoCultivation()\r\n    } else {\r\n      startAutoCultivation(playerId, cultivationType)\r\n    }\r\n  }\r\n\r\n  // Reset store\r\n  const reset = () => {\r\n    stopAutoCultivation()\r\n    cultivationStatus.value = null\r\n    isCultivating.value = false\r\n    loading.value = false\r\n    error.value = null\r\n  }\r\n\r\n  return {\r\n    // State\r\n    cultivationStatus,\r\n    isCultivating,\r\n    loading,\r\n    error,\r\n    autoCultivation,\r\n\r\n    // Getters\r\n    canCultivate,\r\n    canBreakthrough,\r\n    progressPercentage,\r\n    currentRealm,\r\n\r\n    // Actions\r\n    fetchCultivationStatus,\r\n    startCultivation,\r\n    breakthrough,\r\n    getCultivationInfo,\r\n    getRealmColor,\r\n    startAutoCultivation,\r\n    stopAutoCultivation,\r\n    toggleAutoCultivation,\r\n    reset\r\n  }\r\n})\r\n","<template>\r\n  <div v-if=\"!isAuthenticated\" class=\"min-h-screen\">\r\n    <LoginForm />\r\n  </div>\r\n  \r\n  <div v-else class=\"min-h-screen text-white\">\r\n    <!-- Level Up Notification -->\r\n    <LevelUpNotification \r\n      :show=\"showLevelUpNotification\"\r\n      :level-gain=\"levelUpData.levelGain\"\r\n      :new-level=\"levelUpData.newLevel\"\r\n      @hide=\"hideLevelUpNotification\"\r\n    />\r\n    <!-- Header với thông tin người chơi -->\r\n    <header class=\"bg-game-gray/80 backdrop-blur-sm border-b border-white/10\">\r\n      <div class=\"container mx-auto px-4 py-3\">\r\n        <div class=\"flex items-center justify-between\">\r\n          <!-- Thông tin nhân vật -->\r\n          <div class=\"flex items-center space-x-4\">\r\n            <div class=\"w-12 h-12 rounded-full bg-gradient-to-br from-blue-400 to-purple-600 flex items-center justify-center\">\r\n              <span class=\"text-lg font-bold\">{{ player?.name?.charAt(0) || 'V' }}</span>\r\n            </div>\r\n            <div>\r\n              <h2 class=\"text-lg font-semibold\">{{ player?.name || 'Viễn Cổ Đại Năng' }}</h2>\r\n              <p class=\"text-sm text-game-text-secondary\">Cấp {{ player?.level || 138 }} | Chuyển: {{ player?.realm || 'Phàm cảnh' }}</p>\r\n            </div>\r\n          </div>\r\n\r\n          <!-- Tài nguyên -->\r\n          <div class=\"flex items-center space-x-6\">\r\n            <div class=\"text-center\">\r\n              <p class=\"text-sm text-game-text-secondary\">Tiên Ngọc</p>\r\n              <p class=\"text-lg font-semibold text-yellow-400\">{{ getResourceAmount('tien_ngoc') }}</p>\r\n            </div>\r\n            <div class=\"text-center\">\r\n              <p class=\"text-sm text-game-text-secondary\">Linh Thạch</p>\r\n              <p class=\"text-lg font-semibold text-blue-400\">{{ getResourceAmount('linh_thach') }}</p>\r\n            </div>\r\n            <div class=\"text-center\">\r\n              <p class=\"text-sm text-game-text-secondary\">Nguyên Thạch</p>\r\n              <p class=\"text-lg font-semibold text-green-400\">{{ getResourceAmount('nguyen_thach') }}</p>\r\n            </div>\r\n          </div>\r\n\r\n          <!-- Nút chức năng -->\r\n          <div class=\"flex items-center space-x-2\">\r\n            <NuxtLink to=\"/\" class=\"game-button px-6 py-2 rounded-lg text-white font-semibold\">\r\n              🏠 Trang Chủ\r\n            </NuxtLink>\r\n            <button @click=\"handleLogout\" class=\"px-4 py-2 bg-red-500/20 border border-red-500/50 rounded-lg text-red-400 hover:bg-red-500/30 transition-colors\">\r\n              Đăng xuất\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </header>\r\n\r\n    <!-- Navigation Menu -->\r\n    <nav class=\"bg-game-gray/60 backdrop-blur-sm border-b border-white/10\">\r\n      <div class=\"container mx-auto px-4 py-2\">\r\n        <!-- Tabs -->\r\n        <div class=\"flex space-x-1 mb-4\">\r\n          <NuxtLink to=\"/character\" class=\"px-4 py-2 text-game-text-secondary hover:text-white transition-colors\">\r\n            Nhân vật\r\n          </NuxtLink>\r\n          <button class=\"px-4 py-2 bg-game-light rounded-lg text-white font-medium\">\r\n            Tu Luyện\r\n          </button>\r\n        </div>\r\n\r\n        <!-- Menu Icons -->\r\n        <div class=\"grid grid-cols-7 gap-4\">\r\n          <div v-for=\"menuItem in menuItems\" :key=\"menuItem.name\" \r\n               @click=\"handleMenuClick(menuItem)\"\r\n               class=\"flex flex-col items-center p-3 rounded-lg hover:bg-game-light/50 transition-colors cursor-pointer\"\r\n               :class=\"{ 'bg-game-accent/20 border border-game-accent': menuItem.active }\">\r\n            <div class=\"w-12 h-12 rounded-full bg-game-light flex items-center justify-center mb-2\">\r\n              <span class=\"text-2xl\">{{ menuItem.icon }}</span>\r\n            </div>\r\n            <span class=\"text-xs text-center\">{{ menuItem.name }}</span>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </nav>\r\n\r\n    <!-- Main Content -->\r\n    <main class=\"container mx-auto px-4 py-8\">\r\n      <div class=\"text-center mb-8\">\r\n        <h1 class=\"text-4xl font-bold mb-4\">🧘 Tu Luyện</h1>\r\n        <p class=\"text-game-text-secondary\">Nâng cao cấp độ và cảnh giới của bạn</p>\r\n      </div>\r\n\r\n      <!-- Character và companions -->\r\n      <div class=\"flex items-center justify-center space-x-8 mb-8\">\r\n        <!-- Companion trái -->\r\n        <div class=\"text-center\">\r\n          <div class=\"w-20 h-20 rounded-full bg-gradient-to-br from-pink-400 to-purple-600 flex items-center justify-center mb-2 mx-auto\">\r\n            <span class=\"text-2xl\">🌸</span>\r\n          </div>\r\n          <p class=\"text-sm\">Thiên Hoa Tiên Cơ</p>\r\n          <span class=\"text-xs text-game-accent\">+60</span>\r\n        </div>\r\n\r\n        <!-- Nhân vật chính -->\r\n        <div class=\"text-center\">\r\n          <div class=\"w-32 h-32 rounded-full bg-gradient-to-br from-blue-400 to-purple-600 flex items-center justify-center mb-4 mx-auto\">\r\n            <div class=\"w-24 h-24 rounded-full bg-white/20 flex items-center justify-center\">\r\n              <span class=\"text-4xl\">☯</span>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <!-- Companion phải -->\r\n        <div class=\"text-center\">\r\n          <div class=\"w-20 h-20 rounded-full bg-gradient-to-br from-blue-400 to-cyan-600 flex items-center justify-center mb-2 mx-auto\">\r\n            <span class=\"text-2xl\">🐉</span>\r\n          </div>\r\n          <p class=\"text-sm\">Ngân Long</p>\r\n          <span class=\"text-xs text-game-accent\">+100</span>\r\n        </div>\r\n      </div>\r\n\r\n      <!-- Progress Bar -->\r\n      <div class=\"max-w-2xl mx-auto mb-6\">\r\n        <div class=\"flex justify-between items-center mb-2\">\r\n          <span class=\"text-sm text-game-text-secondary\">Kinh Nghiệm</span>\r\n          <span class=\"text-sm text-game-text-secondary\">\r\n            {{ Math.round(cultivationStore.progressPercentage) }}%\r\n          </span>\r\n        </div>\r\n        <div class=\"w-full bg-game-light rounded-full h-4\">\r\n          <div \r\n            class=\"progress-bar h-4 rounded-full transition-all duration-500\"\r\n            :style=\"{ width: `${cultivationStore.progressPercentage}%` }\"\r\n          ></div>\r\n        </div>\r\n        <div class=\"flex justify-between items-center mt-1\">\r\n          <span class=\"text-sm\">\r\n            {{ cultivationStore.cultivationStatus?.cultivation?.currentExp?.toLocaleString() || '0' }}\r\n          </span>\r\n          <span class=\"text-sm\">\r\n            {{ cultivationStore.cultivationStatus?.cultivation?.nextLevelExp?.toLocaleString() || '0' }}\r\n          </span>\r\n        </div>\r\n      </div>\r\n\r\n      <!-- Status Text -->\r\n      <div class=\"max-w-2xl mx-auto mb-8\">\r\n        <p class=\"text-lg font-semibold text-orange-400 mb-2\">\r\n          {{ autoCultivation ? 'Tự động tu luyện đang chạy...' : (cultivationStatus?.isCultivating ? 'Đang tu luyện...' : 'Đang nhập định, vận chuyển huyền công theo chu thiên...') }}\r\n        </p>\r\n        <p class=\"text-sm text-game-text-secondary italic\">\r\n          \"Linh khí hội tụ, nguyên thần an định, thiên địa cảm ứng, đạo vận luân hồi.\"\r\n        </p>\r\n        <div v-if=\"autoCultivation\" class=\"mt-2 text-xs text-green-400\">\r\n          ⚡ Tự động tu luyện mỗi 3 giây - Nhấn nút để dừng\r\n        </div>\r\n      </div>\r\n\r\n      <!-- Cultivation Controls -->\r\n      <div class=\"max-w-2xl mx-auto mb-8\">\r\n        <div class=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n          <!-- Tu luyện cơ bản -->\r\n          <button\r\n            @click=\"handleCultivation('basic')\"\r\n            :disabled=\"!canCultivate || loading\"\r\n            class=\"game-button py-3 px-6 rounded-lg text-white font-semibold disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-300\"\r\n          >\r\n            <div class=\"flex items-center justify-center space-x-2\">\r\n              <span class=\"text-xl\">🧘</span>\r\n                              <div class=\"text-left\">\r\n                  <div class=\"text-sm\">Tu Luyện Cơ Bản</div>\r\n                  <div class=\"text-xs opacity-80\">100 Sức Mạnh Chiến Đấu</div>\r\n                </div>\r\n            </div>\r\n          </button>\r\n\r\n          <!-- Tu luyện nâng cao -->\r\n          <button\r\n            @click=\"handleCultivation('advanced')\"\r\n            :disabled=\"!canCultivate || loading\"\r\n            class=\"bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 py-3 px-6 rounded-lg text-white font-semibold disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-300\"\r\n          >\r\n            <div class=\"flex items-center justify-center space-x-2\">\r\n              <span class=\"text-xl\">⚡</span>\r\n                              <div class=\"text-left\">\r\n                  <div class=\"text-sm\">Tu Luyện Nâng Cao</div>\r\n                  <div class=\"text-xs opacity-80\">500 Sức Mạnh Chiến Đấu</div>\r\n                </div>\r\n            </div>\r\n          </button>\r\n\r\n          <!-- Đột phá -->\r\n          <button\r\n            @click=\"handleBreakthrough\"\r\n            :disabled=\"!canBreakthrough || loading\"\r\n            class=\"bg-gradient-to-r from-yellow-500 to-orange-500 hover:from-yellow-600 hover:to-orange-600 py-3 px-6 rounded-lg text-white font-semibold disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-300\"\r\n          >\r\n            <div class=\"flex items-center justify-center space-x-2\">\r\n              <span class=\"text-xl\">💥</span>\r\n                              <div class=\"text-left\">\r\n                  <div class=\"text-sm\">Đột Phá</div>\r\n                  <div class=\"text-xs opacity-80\">1000+ Sức Mạnh Chiến Đấu</div>\r\n                </div>\r\n            </div>\r\n          </button>\r\n        </div>\r\n\r\n        <!-- Auto Cultivation Controls -->\r\n        <div class=\"mt-6 p-4 bg-game-light/30 rounded-lg\">\r\n          <div class=\"flex items-center justify-between mb-4\">\r\n            <h3 class=\"text-lg font-semibold text-white\">Tự Động Tu Luyện</h3>\r\n            <div class=\"flex items-center space-x-2\">\r\n              <span class=\"text-sm text-game-text-secondary\">Trạng thái:</span>\r\n              <span \r\n                class=\"px-3 py-1 rounded-full text-xs font-semibold\"\r\n                :class=\"autoCultivation ? 'bg-green-500/20 text-green-400' : 'bg-red-500/20 text-red-400'\"\r\n              >\r\n                {{ autoCultivation ? 'Đang chạy' : 'Tạm dừng' }}\r\n              </span>\r\n            </div>\r\n          </div>\r\n          \r\n          <div class=\"flex items-center space-x-4\">\r\n            <button\r\n              @click=\"toggleAutoCultivation('basic')\"\r\n              :disabled=\"!canCultivate || loading\"\r\n              class=\"flex-1 bg-gradient-to-r from-blue-500 to-cyan-500 hover:from-blue-600 hover:to-cyan-600 py-2 px-4 rounded-lg text-white font-semibold disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-300\"\r\n            >\r\n              <div class=\"flex items-center justify-center space-x-2\">\r\n                <span class=\"text-lg\">{{ autoCultivation ? '⏸️' : '▶️' }}</span>\r\n                <span>{{ autoCultivation ? 'Dừng' : 'Bắt đầu' }} Tự Động</span>\r\n              </div>\r\n            </button>\r\n            \r\n            <button\r\n              @click=\"toggleAutoCultivation('advanced')\"\r\n              :disabled=\"!canCultivate || loading\"\r\n              class=\"flex-1 bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 py-2 px-4 rounded-lg text-white font-semibold disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-300\"\r\n            >\r\n              <div class=\"flex items-center justify-center space-x-2\">\r\n                <span class=\"text-lg\">{{ autoCultivation ? '⏸️' : '⚡' }}</span>\r\n                <span>{{ autoCultivation ? 'Dừng' : 'Bắt đầu' }} Nâng Cao</span>\r\n              </div>\r\n            </button>\r\n          </div>\r\n          \r\n          <div class=\"mt-3 text-xs text-game-text-secondary\">\r\n            <p>• Tự động tu luyện mỗi 6 giây, mỗi lần +1000 EXP</p>\r\n            <p>• Tự động level up khi đủ kinh nghiệm</p>\r\n            <p>• Có thể dừng bất kỳ lúc nào</p>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <!-- Cultivation Info -->\r\n      <div class=\"max-w-4xl mx-auto\">\r\n        <div class=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n          <!-- Thông tin cấp độ -->\r\n          <div class=\"game-card p-6 rounded-lg\">\r\n            <h3 class=\"text-lg font-semibold text-white mb-4 text-center\">Thông Tin Tu Luyện</h3>\r\n            <div class=\"space-y-3\">\r\n              <div class=\"flex justify-between items-center\">\r\n                <span class=\"text-game-text-secondary\">Cấp Độ:</span>\r\n                <span class=\"text-xl font-bold\" :style=\"{ color: realmColor }\">\r\n                  {{ cultivationStatus?.cultivation?.currentLevel || player?.level || 1 }}\r\n                </span>\r\n              </div>\r\n              <div class=\"flex justify-between items-center\">\r\n                <span class=\"text-game-text-secondary\">Cảnh Giới:</span>\r\n                <span class=\"text-lg font-semibold\" :style=\"{ color: realmColor }\">\r\n                  {{ cultivationStatus?.cultivation?.realm || player?.realm || 'Phàm cảnh' }}\r\n                </span>\r\n              </div>\r\n                              <div class=\"flex justify-between items-center\">\r\n                  <span class=\"text-game-text-secondary\">Sức Mạnh Chiến Đấu:</span>\r\n                  <span class=\"text-lg font-semibold text-purple-400\">\r\n                    {{ characterStore.combatPower?.toLocaleString() || '0' }}\r\n                  </span>\r\n                </div>\r\n              <div class=\"flex justify-between items-center\">\r\n                <span class=\"text-game-text-secondary\">Trạng thái:</span>\r\n                <span class=\"text-sm\" :class=\"canCultivate ? 'text-green-400' : 'text-red-400'\">\r\n                  {{ canCultivate ? 'Có thể tu luyện' : 'Không đủ tài nguyên' }}\r\n                </span>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          <!-- Thông tin cảnh giới -->\r\n          <div class=\"game-card p-6 rounded-lg\">\r\n            <h3 class=\"text-lg font-semibold text-white mb-4 text-center\">Tiến Độ Cảnh Giới</h3>\r\n            <div v-if=\"realmProgress\" class=\"space-y-3\">\r\n              <div class=\"flex justify-between items-center\">\r\n                <span class=\"text-game-text-secondary\">Cảnh giới hiện tại:</span>\r\n                <span class=\"text-lg font-semibold\" :style=\"{ color: realmColor }\">\r\n                  {{ cultivationStatus?.cultivation?.realm || 'Phàm cảnh' }}\r\n                </span>\r\n              </div>\r\n              <div class=\"flex justify-between items-center\">\r\n                <span class=\"text-game-text-secondary\">Tiến độ:</span>\r\n                <span class=\"text-lg font-semibold\">\r\n                  {{ realmProgress.current }}/{{ realmProgress.max }}\r\n                </span>\r\n              </div>\r\n              <div class=\"w-full bg-game-light rounded-full h-3\">\r\n                <div \r\n                  class=\"h-3 rounded-full transition-all duration-500\"\r\n                  :style=\"{ \r\n                    width: `${realmProgress.percentage}%`,\r\n                    background: `linear-gradient(90deg, ${realmColor} 0%, ${nextRealmColor} 100%)`\r\n                  }\"\r\n                ></div>\r\n              </div>\r\n              <div class=\"text-center text-sm text-game-text-secondary\">\r\n                Cần cấp {{ nextRealmLevel }} để lên {{ nextRealm }}\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </main>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\n// Stores\r\nconst authStore = useAuthStore()\r\nconst playerStore = usePlayerStore()\r\nconst cultivationStore = useCultivationStore()\r\nconst characterStore = useCharacterStore()\r\n\r\n// Computed\r\nconst isAuthenticated = computed(() => authStore.isLoggedIn)\r\nconst player = computed(() => playerStore.player)\r\nconst resources = computed(() => playerStore.resources)\r\nconst cultivationStatus = computed(() => cultivationStore.cultivationStatus)\r\nconst loading = computed(() => cultivationStore.loading)\r\nconst canCultivate = computed(() => cultivationStore.canCultivate)\r\nconst canBreakthrough = computed(() => cultivationStore.canBreakthrough)\r\nconst autoCultivation = computed(() => cultivationStore.autoCultivation)\r\n\r\n// Level up notification\r\nconst showLevelUpNotification = ref(false)\r\nconst levelUpData = ref({\r\n  levelGain: 0,\r\n  newLevel: 0\r\n})\r\n\r\n// Methods\r\nconst getResourceAmount = (resourceName) => {\r\n  const resource = playerStore.getResourceByName(resourceName)\r\n  return resource ? Number(resource.amount).toLocaleString() : '0'\r\n}\r\n\r\nconst handleLogout = () => {\r\n  authStore.logout()\r\n  playerStore.reset()\r\n  cultivationStore.reset()\r\n}\r\n\r\nconst handleMenuClick = (menuItem) => {\r\n  if (menuItem.route) {\r\n    navigateTo(menuItem.route)\r\n  } else {\r\n    console.log(`${menuItem.name} chưa được phát triển`)\r\n  }\r\n}\r\n\r\n// Cultivation methods\r\nconst realmColor = computed(() => {\r\n  const realm = cultivationStatus.value?.cultivation?.realm || player.value?.realm || 'Phàm cảnh'\r\n  return cultivationStore.getRealmColor(realm)\r\n})\r\n\r\nconst realmProgress = computed(() => {\r\n  return cultivationStatus.value?.cultivation?.realmProgress\r\n})\r\n\r\nconst cultivationInfo = computed(() => {\r\n  const level = cultivationStatus.value?.cultivation?.currentLevel || player.value?.level || 1\r\n  return cultivationStore.getCultivationInfo(level)\r\n})\r\n\r\nconst nextRealm = computed(() => cultivationInfo.value.nextRealm.name)\r\nconst nextRealmColor = computed(() => cultivationInfo.value.nextRealm.color)\r\nconst nextRealmLevel = computed(() => cultivationInfo.value.nextRealm.min)\r\n\r\nconst handleCultivation = async (type) => {\r\n  try {\r\n    const result = await cultivationStore.startCultivation(player.value.id, type)\r\n    \r\n    // Cập nhật tài nguyên trong player store\r\n    await playerStore.fetchResources(player.value.id)\r\n    \r\n    // Hiển thị thông báo thành công\r\n    if (result?.data) {\r\n      console.log(`Tu luyện thành công! Nhận được ${result.data.experienceGain} kinh nghiệm`)\r\n    }\r\n  } catch (err) {\r\n    console.error('Lỗi tu luyện:', err)\r\n  }\r\n}\r\n\r\nconst handleBreakthrough = async () => {\r\n  try {\r\n    const result = await cultivationStore.breakthrough(player.value.id)\r\n    \r\n    // Cập nhật tài nguyên trong player store\r\n    await playerStore.fetchResources(player.value.id)\r\n    \r\n    // Hiển thị thông báo thành công\r\n    if (result?.data?.breakthrough) {\r\n      const { oldLevel, newLevel, oldRealm, newRealm, isRealmChange } = result.data.breakthrough\r\n      console.log(`Đột phá thành công! Từ cấp ${oldLevel} lên cấp ${newLevel}`)\r\n      if (isRealmChange) {\r\n        console.log(`Chúc mừng! Đã lên cảnh giới mới: ${newRealm}`)\r\n      }\r\n    }\r\n  } catch (err) {\r\n    console.error('Lỗi đột phá:', err)\r\n  }\r\n}\r\n\r\nconst toggleAutoCultivation = (cultivationType) => {\r\n  if (player.value?.id) {\r\n    cultivationStore.toggleAutoCultivation(player.value.id, cultivationType)\r\n  }\r\n}\r\n\r\n// Level up notification methods\r\nconst showLevelUp = (levelGain, newLevel) => {\r\n  levelUpData.value = {\r\n    levelGain,\r\n    newLevel\r\n  }\r\n  showLevelUpNotification.value = true\r\n}\r\n\r\nconst hideLevelUpNotification = () => {\r\n  showLevelUpNotification.value = false\r\n}\r\n\r\n// Menu items data\r\nconst menuItems = [\r\n  { name: 'Nhân vật', icon: '👤', active: false, route: '/character' },\r\n  { name: 'Thiên Phú', icon: '⭐', active: false, route: '/talent' },\r\n  { name: 'Cửa Hàng', icon: '🏠', active: false, route: '/shop' },\r\n  { name: 'Túi', icon: '🎒', active: false, route: '/inventory' },\r\n  { name: 'Tu Luyện', icon: '🧘', active: true },\r\n  { name: 'Đạo Lô', icon: '🔥', active: false, route: '/furnace' },\r\n  { name: 'Linh Thú', icon: '🐾', active: false, route: '/spirit-beast' },\r\n  { name: 'Đạo Lữ', icon: '👥', active: false },\r\n  { name: 'Pháp Bảo', icon: '⚔️', active: false },\r\n  { name: 'Luyện Đan', icon: '⚗️', active: false },\r\n  { name: 'Luyện Khí', icon: '🔨', active: false },\r\n  { name: 'Trận pháp', icon: '🔮', active: false },\r\n  { name: 'Xếp Hạng', icon: '🏆', active: false, route: '/ranking' },\r\n  { name: 'Danh hiệu', icon: '👑', active: false },\r\n  { name: 'Nhiệm Vụ', icon: '📋', active: false, route: '/quest' },\r\n  { name: 'Nạp Thẻ', icon: '🏛️', active: false }\r\n]\r\n\r\n// Initialize on mount\r\nonMounted(async () => {\r\n  authStore.initializeAuth()\r\n  \r\n  if (isAuthenticated.value && authStore.user?.player) {\r\n    await playerStore.initializePlayer(authStore.user.player.id)\r\n    await cultivationStore.fetchCultivationStatus(authStore.user.player.id)\r\n    \r\n    // Tự động bắt đầu tu luyện cơ bản khi vào trang\r\n    if (canCultivate.value) {\r\n      cultivationStore.startAutoCultivation(authStore.user.player.id, 'basic')\r\n    }\r\n  }\r\n  \r\n  // Listen for level up events\r\n  if (typeof window !== 'undefined') {\r\n    window.addEventListener('levelUp', (event) => {\r\n      const { levelGain, newLevel } = event.detail\r\n      showLevelUp(levelGain, newLevel)\r\n    })\r\n  }\r\n})\r\n\r\n// Watch for authentication changes\r\nwatch(isAuthenticated, async (newValue) => {\r\n  if (newValue && authStore.user?.player) {\r\n    await playerStore.initializePlayer(authStore.user.player.id)\r\n    await cultivationStore.fetchCultivationStatus(authStore.user.player.id)\r\n    \r\n    // Tự động bắt đầu tu luyện cơ bản khi đăng nhập\r\n    if (canCultivate.value) {\r\n      cultivationStore.startAutoCultivation(authStore.user.player.id, 'basic')\r\n    }\r\n  } else {\r\n    cultivationStore.reset()\r\n  }\r\n})\r\n\r\n// Dừng auto-cultivation khi rời khỏi trang\r\nonBeforeUnmount(() => {\r\n  cultivationStore.stopAutoCultivation()\r\n  \r\n  // Cleanup event listener\r\n  if (typeof window !== 'undefined') {\r\n    window.removeEventListener('levelUp', () => {})\r\n  }\r\n})\r\n</script>\r\n"],"version":3}